<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2.Promise</title>
    <!-- 
        ë‚ ì§œ : 2024/02/14
        ì´ë¦„ : ì´ì˜ˆë‚˜
        ë‚´ìš© : ìë°”ìŠ¤í¬ë¦½íŠ¸ ë¹„ë™ê¸° ì²˜ë¦¬
     -->
</head>

<body>
    <h3>ğŸˆ2.Promise</h3>

    <script>

        // promise ê°ì²´ ìƒì„±(ì œì‘ì½”ë“œ)
        const result = false;

        const promise = new Promise((resolve, reject)=>{

            if(result){
                resolve('promise success...');
            }else{
                reject('promise failed...');
            }
        });

        // promise ê°ì²´ ì‚¬ìš©(ì†Œë¹„ì½”ë“œ)
        promise
            .then((msg)=>{
                console.log(msg);
            })
            .catch((msg)=>{
                console.log(msg);
            })
            .finally(()=>{
                console.log('promise finally...');
            });

        // promiseë¥¼ ì´ìš©í•œ ë¹„ë™ê¸° ì²˜ë¦¬
        function step1(){ 

            return new Promise((resolve, reject)=>{
                setTimeout(()=>{
                    resolve('step1...');
                }, 1000);
            });

        }

        function step2(msg){
            console.log(msg);
            return new Promise((resolve, reject)=>{
                setTimeout(()=>{
                    resolve('step2...');
                }, 3000);
            });
        }

        function step3(msg){
            console.log(msg);
            return new Promise((resolve, reject)=>{
                setTimeout(()=>{
                    resolve('step3...');
                }, 2000);
            });
        }

        
        step1()
            .then((msg)=>step2(msg))
            .then((msg)=>step3(msg))
            .then((msg)=>{
                console.log(msg);
            });
            

        // asyncì™€ awaitë¥¼ ì´ìš©í•œ ë¹„ë™ê¸° ì²˜ë¦¬
        async function start(){            
            const result1 = await step1();
            const result2 = await step2(result1);
            const result3 = await step3(result2);
            console.log(result3);
        }
        
        start();

            
        // promiseë¥¼ ì´ìš©í•œ ì»¤í”¼ ì˜ˆì œ
        window.onload = function(){

            const inputText = document.getElementsByName('coffee')[0];
            const btnOrder = document.getElementById('btnOrder');
            const message = document.getElementById('message');


            btnOrder.onclick = function(){              
                
                const coffee = inputText.value;                
                message.innerText = `${coffee} ì œì¡° ì‹œì‘...`;

                makeCoffee(coffee);

            } // onclick end

            function boilWater(coffee){
                message.innerText = `${coffee}ë¥¼ ìœ„í•´ ë¬¼ì„ ë“ì…ë‹ˆë‹¤.`;

                return new Promise((resolve, reject)=>{
                    setTimeout(() => {
                        resolve(coffee);
                    }, 2000);
                });
            }

            function brewCoffee(coffee){
                message.innerText = `${coffee}ë¥¼ ë‚´ë¦½ë‹ˆë‹¤.`;

                return new Promise((resolve, reject)=>{

                    setTimeout(() => {
                        resolve(coffee);
                    }, 3000);
                });
            }
            
            function pourCoffee(coffee){
                message.innerText = `${coffee}ë¥¼ ë”°ë¦…ë‹ˆë‹¤.`;

                return new Promise((resolve, reject)=>{

                    setTimeout(() => {
                        resolve(coffee);
                    }, 1000);
                });
            }
            
            function doneCoffee(coffee){
                message.innerText = `${coffee}ê°€ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.`;
            }
            

            function makeCoffee(coffee){
                boilWater(coffee)
                    .then(brewCoffee)
                    .then(pourCoffee)
                    .then(doneCoffee);
            }



        } // onload end


    </script>


    <input type="text" name="coffee">
    <input type="button" id="btnOrder" value="ì£¼ë¬¸í•˜ê¸°">

    <h4 id="message">ì¤€ë¹„ì¤‘...</h4>

</body>
</html>